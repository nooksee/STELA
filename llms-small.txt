## AGENTS.md
# AGENTS.md
# Pointer-first agent constitution for Stela (no duplicated canon text).

## 1. Staffing Protocol
- Operator (Human): Owns final decisions, approvals, and secrets. Performs all commits, pushes, and merges.
- Integrator (Lead AI): Maintains governance, structural integrity, and auditing. Generates Dispatch Packets and detects system drift.
- Contractor (Guest AI): Executes specific logic tasks and drafts implementation details within a defined scope.

## 2. Behavioral Logic Standard
- Linguistic Precision: No contractions.
- Linguistic Precision: Quantitative reporting required for deviations from protocol.
- Linguistic Precision: Absolute literalism; seek clarification for ambiguity before proceeding.
- Operational Directives: Anti-drift governance; logic or files misaligned with TRUTH.md are a system failure.
- Operational Directives: Context hygiene; ops/lib/manifests/CONTEXT.md must exclude docs/library/agents, docs/library/tasks, and docs/library/skills.
- Operational Directives: Logic conflict resolution; stop until the Operator redefines parameters if a task violates TRUTH.md.
- Operational Directives: Equilibrium maintenance; a task is complete only when SoP.md is updated.
- Operational Directives: Reuse-first discipline; cross-reference ops/ templates before creating new artifacts.
- Operational Directives: Contractor closeout skill harvesting uses ops/lib/scripts/skill.sh harvest for provenance.
- Operational Directives: Contractor closeout skill harvesting forbids manual creation of docs/library/skills markdown files.
- Operational Directives: Contractor closeout skill harvesting is mandatory for production payloads and optional for platform maintenance.

## 3. Hard Constraints (SSOT)
- TRUTH.md
- SoP.md
- TASK.md
- ops/lib/manifests/CONTEXT.md
- docs/library/MANUAL.md
- docs/library/MAP.md

## 4. Entry Points
- llms.txt

## 5. Drafting Proposal Protocol
- Integrator proposals: An Integrator may propose a work branch name and Base HEAD when they are not yet provided.
- Operator authority: The Operator creates branches and provides the final Base HEAD; Contractors do not create or switch branches.
- Provisional marking: Any provisional value must be prefixed with PROPOSED: during drafting and must be removed or replaced with finalized values before any worker runs a DP.


## docs/library/INDEX.md
# Docs Library Index (Authorized Surface Registry)
#
# Format: topic | title | path (repo-relative)
#
# This file is the "Authorized Surface List" for the platform.
# Only high-value, maintained documentation appears here.
# If a file is listed here, it is protected Canon.

# --- 1. The Constitution (Law & Logic) ---
system-constitution | Stela System Constitution | TRUTH.md
agent-jurisdiction  | Staffing & Jurisdiction   | AGENTS.md
project-governance  | Governance & Drift        | docs/GOVERNANCE.md

# --- 2. The Ledger (State Persistence) ---
state-of-play       | SoP (History Ledger)      | SoP.md
active-contract     | TASK (Dispatch Packet)    | TASK.md

# --- 3. The Console (Operator Interfaces) ---
operator-manual     | Operator Console          | docs/library/MANUAL.md
continuity-map      | State Topology            | docs/library/MAP.md
quickstart          | Onboarding & Workflow     | docs/QUICKSTART.md
docs-front-door     | Docs Root Index           | docs/INDEX.md

# --- 4. Subsystems (Deep Dives) ---
ops-subsystem       | Ops Engine Room           | docs/ops/INDEX.md
context-spec        | Context Rehydration       | docs/CONTEXT.md
security-ops        | Security Operations       | docs/security/README.md

# --- 5. Skills (Production Payloads / On-Demand) ---
skills-template     | Skills Promotion Template | SKILL.md
skill-s-learn-01    | Skill: Verification Loop  | docs/library/skills/S-LEARN-01.md
skill-s-learn-02    | Skill: Project Guidelines | docs/library/skills/S-LEARN-02.md
skill-s-learn-03    | Skill: Zenith Reference   | docs/library/skills/S-LEARN-03.md
skill-s-learn-04    | Skill: Coding Standards   | docs/library/skills/S-LEARN-04.md
skill-s-learn-05    | Skill: Security Protocols | docs/library/skills/S-LEARN-05.md
skill-s-learn-06    | Skill: Advanced Git Forensics | docs/library/skills/S-LEARN-06.md
skill-s-learn-07    | Skill: Harvest and Promote Skills | docs/library/skills/S-LEARN-07.md
skill-s-learn-08 | Skill: Prune SoP and Regenerate Context Bundles | docs/library/skills/S-LEARN-08.md


## docs/library/skills/S-LEARN-01.md
# S-LEARN-01: Verification Loop

## Provenance
- Captured: 2026-02-01
- Origin: System Hardening (DP-OPS-0014)
- Source: Operator Institutional Knowledge
- Friction Context:
  - Hot Zone: Universal / Payload Verification
  - High Churn: CI/CD Gates

## Scope
Production payload work only. Not platform maintenance.

## Invocation guidance
Use this skill when a DP explicitly requests a verification loop. The Trap: "It works on my machine" (ignoring clean-slate hygiene). Solution: Run verification from a clean git state and record exact exit codes.

## Drift preventers
- Stop if the DP scope is platform maintenance.
- Stop on the first failure. Do not proceed to subsequent steps.
- Anti-hallucination: Record actual terminal output. Do not summarize "Passed".

## Procedure
1) Clean State:
   - Run `git status --porcelain`.
   - If output is not empty, STOP. Commit or stash changes before verifying.
2) Type & Lint (Static Analysis):
   - Frontend: `npm run lint` (Ensure 0 exit code).
   - Backend: `ruff check` or `flake8` (Ensure 0 exit code).
3) Build (Compilation Gate):
   - Frontend: `npm run build`.
   - The Trap: Ignoring build warnings.
   - Solution: Inspect logs. If `WARN` appears regarding deps or types, treat as a failure.
4) Test (Logic Gate):
   - Run unit tests: `npm run test` or `pytest`.
   - Record coverage % if reported.
5) Diff Review:
   - Run `git diff --stat`.
   - Verify no files outside the DP Target Files allowlist were touched.
6) Receipt:
   - Copy/paste the summary lines of the above commands into RESULTS.


## docs/library/skills/S-LEARN-02.md
# S-LEARN-02: Project Guidelines (The Stela Stack)

## Provenance
- Captured: 2026-02-01
- Origin: System Hardening (DP-OPS-0014)
- Source: Operator Institutional Knowledge
- Friction Context:
  - Hot Zone: Project Scaffolding
  - High Churn: Architecture Decisions

## Scope
Production payload work only. Not platform maintenance.

## Invocation guidance
Use this skill when initializing or refactoring project payloads. The Trap: Mixing paradigms (e.g., using Django patterns in FastAPI, or Pages Router in App Router). Solution: Adhere strictly to the Stela Stack definitions below.

## Drift preventers
- Stop if the DP attempts to introduce a new language or framework (e.g., Go, Vue, NestJS) without explicit Operator override.
- Strict Isolation: Project code must not import from ops/ or docs/.

## Procedure
1) Directory Authority:
   - Frontend code lives under `src/`.
   - Backend code lives under `app/`.
2) Frontend Stack (Web):
   - Framework: Next.js 14+ (App Router).
   - Language: TypeScript (Strict).
   - UI: Tailwind CSS + Shadcn/UI (Copy-paste component ownership).
   - Structure: `src/app`, `src/components`, `src/lib`.
3) Backend Stack (API):
   - Framework: FastAPI (Python 3.11+).
   - Interface: REST (JSON) + OpenAPI (Auto-generated).
   - Structure: `app/main.py`, `app/routers/`, `app/schemas/` (Pydantic).
4) Data & State:
   - Database: Supabase (Postgres).
   - Auth: Supabase Auth.
   - Caching: Redis (if required).
5) Deployment Contract:
   - Config: Environment variables ONLY (Read from `process.env` or `os.environ`).
   - Secrets: Never committed.
   - Docker: Multi-stage builds required for production artifacts.


## docs/library/skills/S-LEARN-03.md
# S-LEARN-03: Reference Spec Pattern (Zenith)

## Provenance
- Captured: 2026-02-01
- Origin: System Hardening (DP-OPS-0014)
- Source: Operator Institutional Knowledge
- Friction Context:
  - Hot Zone: API Integration
  - High Churn: Data Fetching Logic

## Scope
Production payload work only. Not platform maintenance.

## Invocation guidance
Use this skill when implementing API surfaces or data fetching hooks. The Trap: Inconsistent error parsing causes frontend crashes. Solution: Enforce the Zenith Envelope on the server and the Zenith Hook on the client.

## Drift preventers
- Stop if endpoints return raw arrays or bare primitives.
- Stop if hooks expose raw fetch states without normalization.

## Procedure
1) The Zenith Envelope (Server Response):
   - Envelope type: `{ ok: boolean, data: T, error: { code, message }, meta: any }`.
   - All JSON responses must match:
```json
{ "ok": true, "data": {"...": "..."}, "error": null, "meta": { "trace_id": "..." } }
```
   - On Error: `"ok": false, "data": null, "error": { "code": "E_...", "message": "Human readable" }`.
2) The Zenith Hook (Client State):
   - Custom hooks must return:
```ts
{
  data: T | null;
  loading: boolean;
  error: string | null;
  refresh: () => Promise<void>;
}
```
   - Define the Fetch Hook Pattern: `useZenithQuery<T>`.
   - The Trap: isLoading sticking to true on failure.
   - Solution: Ensure `finally { loading = false }` block.
3) Normalization:
   - The Client Wrapper must intercept non-200 HTTP statuses and convert them into the Zenith Error format before the component sees them.


## docs/library/skills/S-LEARN-04.md
# S-LEARN-04: Coding Standards

## Provenance
- Captured: 2026-02-01
- Origin: System Hardening (DP-OPS-0014)
- Source: Operator Institutional Knowledge
- Friction Context:
  - Hot Zone: Code Review
  - High Churn: Syntax Formatting

## Scope
Production payload work only.
Not platform maintenance.

## Invocation guidance
Use this skill when writing or reviewing payload code.
**The Trap:** "It runs, so it is fine."
**Solution:** Code must be readable, typed, and formatted.

## Drift preventers
- Stop if `any` is used in TypeScript.
- Stop if Python code is not formatted by Black.

## Procedure
1) **TypeScript (Frontend):**
   - **Strict Mode:** `strict: true` in `tsconfig.json`.
   - **No Any:** Use `unknown` or specific interfaces.
   - **Named Exports:** Prefer named exports over default exports for components.
   - **Naming:** `PascalCase` for Components/Interfaces. `camelCase` for vars/hooks.
2) **Python (Backend):**
   - **Type Hints:** Mandatory for all function arguments and returns.
   - **Pydantic:** Use Pydantic models for all data exchange (Schemas), not raw dicts.
   - **Formatter:** Code must pass `black --check`.
   - **Imports:** Sort with `isort`.
3) **Comments & Docs:**
   - **Why, not What:** Comment complex logic reasoning, not syntax.
   - **Docstrings:** Required for public API endpoints (FastAPI uses these for Swagger UI).


## docs/library/skills/S-LEARN-05.md
# S-LEARN-05: Security Protocols

## Provenance
- Captured: 2026-02-01
- Origin: System Hardening (DP-OPS-0014)
- Source: Operator Institutional Knowledge
- Friction Context:
  - Hot Zone: Auth & Data Access
  - High Churn: Permission Logic

## Scope
Production payload work only.
Not platform maintenance.

## Invocation guidance
Use this skill when configuring database access, API surfaces, or auth flows.
**The Trap:** "Service Role" usage in client-side code.
**Solution:** Never expose service keys. Use RLS.

## Drift preventers
- Stop if a secret is found in code (even commented out).
- Stop if an API route allows `*` CORS in production configuration.

## Procedure
1) **Supabase RLS (Row Level Security):**
   - **Mandate:** RLS must be enabled on ALL public tables.
   - **Policy:** Explicitly define `SELECT`, `INSERT`, `UPDATE`, `DELETE` policies.
   - **Trap:** `USING (true)` (Public access).
   - **Solution:** `USING (auth.uid() = user_id)`.
2) **FastAPI CORS:**
   - Define `allow_origins` from environment variables.
   - **Negative Check:** Do not allow `allow_origins=["*"]` unless explicitly scoped to a development-only branch logic.
3) **Input Validation:**
   - **Frontend:** Validate forms with Zod before submission.
   - **Backend:** Validate payloads with Pydantic. Relying on frontend validation is a security failure.
4) **Dependency Hygiene:**
   - Pin versions in `package.json` / `requirements.txt`.
   - Run `npm audit` / `pip-audit` if available.


## docs/library/skills/S-LEARN-06.md
# S-LEARN-06: Advanced Git Forensics

## Provenance
- Captured: 2026-02-01
- Origin: System Hardening (DP-OPS-0015)
- Source: Operator Institutional Knowledge
- Friction Context:
  - Hot Zone: Debugging / Friction Analysis
  - High Churn: Legacy Code

## Scope
Production payload work and platform maintenance.

## Invocation guidance
Use this skill when ops/lib/scripts/heuristics.sh fails to identify the correct Hot Zone, or when debugging complex regressions. The Trap: "I remember where the bug is." (Human memory is faulty). Solution: Let the git logs prove the location of friction.

## Drift preventers
- Stop if the DP scope prevents shell access.
- Anti-hallucination: Rely on git outputs, not intuition.

## Procedure
1) Hot Zone Detection (Volume):
   - Run: `git diff --numstat main...HEAD | sort -nr | head -n 5`
   - Goal: Identify where the most lines are changing.
2) High Churn Detection (Frequency):
   - Run: `git log --name-only --format="" main...HEAD | sort | uniq -c | sort -nr | head -n 5`
   - Goal: Identify files touched most often (instability).
3) Blame Analysis (Context):
   - Run: `git blame -w -C -L <start>,<end> <file>`
   - Trap: Ignoring whitespace changes.
   - Solution: Use -w to ignore whitespace and focus on logic changes.
4) Topology Mapping:
   - Use `find . -maxdepth 2 -not -path '*/.*'` to map directory structures before refactoring.


## docs/library/skills/S-LEARN-07.md
# S-LEARN-07: Harvest and Promote Skills

## Provenance
- Captured: 2026-02-01
- Origin: System Hardening (DP-OPS-0015)
- Source: Operator Institutional Knowledge
- Friction Context:
  - Hot Zone: Task Closeout
  - High Churn: Knowledge Loss

## Scope
Production payload work only. Not platform maintenance.

## Invocation guidance
Use this skill during DP closeout to capture reusable workflows. The Trap: "I will write the skill manually." (Missing forensic provenance). Solution: Always use the harvest tool to generate the draft.

## Drift preventers
- Stop if the Skills Context Hazard check fails (ops/lib/manifests/CONTEXT.md must not contain skills).
- Stop if the draft contains TODO or placeholders.

## Procedure
1) Harvest (Draft Generation):
   - Run `ops/lib/scripts/skill.sh harvest`.
   - Input: Provide concrete Context (When to use) and Solution (What to do).
   - Constraint: Do not edit the `## Provenance` block.
2) Refine (Quality Gate):
   - Review the generated draft in `storage/handoff/`.
   - Trap: Leaving "ENTER_SOLUTION" placeholders.
   - Solution: Run `grep -E "TODO|ENTER_|REPLACE_" <draft_path>`. If hits found, Fix before promoting.
3) Promote (Registry):
   - Run `ops/lib/scripts/skill.sh promote <draft_path>`.
   - Verify `docs/library/INDEX.md` contains the new entry.
4) Proof:
   - Include the harvest/promote command outputs in the DP RESULTS file.


## SoP.md
Archive policy: keep most recent 30 entries; older entries moved to `storage/archives/root/SoP-archive-YYYY-MM.md`.

## 2026-02-04 - DP-OPS-0020: Phase Two Doctrine (Truth, Hygiene, Style)

- Purpose: Compress canon, add pruning and bundling automation, and enforce uniform style.
- What shipped:
  - Refactored TRUTH.md and AGENTS.md into axiomatic, compressed canon.
  - Updated TASK.md headings to decimal format and added closeout checks for prune and llms.
  - Added ops/bin/prune for SoP sliding window archiving and handoff cleanup.
  - Added ops/bin/llms and generated llms-small.txt and llms-full.txt bundles.
  - Added markdownlint configuration and style and llms lint scripts.
  - Updated llms.txt and recorded governance changes.
- Verification:
  - `./ops/bin/dump --scope=platform`
  - `bash tools/lint/context.sh`
  - `bash tools/lint/truth.sh`
  - `bash tools/lint/style.sh`
  - `bash tools/lint/llms.sh`
  - `bash ops/bin/prune`
- Risk / rollback:
  - Risk: Low (governance and automation updates only).
  - Rollback: revert `TRUTH.md`, `AGENTS.md`, `TASK.md`, `SoP.md`, `llms.txt`, `.markdownlint.json`, `ops/bin/prune`, `ops/bin/llms`, `tools/lint/llms.sh`, `tools/lint/style.sh`, `llms-small.txt`, and `llms-full.txt`.


## 2026-02-04 — DP-OPS-0019: Context Hazard Guardrails

- Purpose: Strengthen context doctrine and guardrails to keep library directories out of the global manifest.
- What shipped:
  - Defined Context Hazard in TRUTH and marked library directories as JIT-only.
  - Added Context Hygiene directive in AGENTS to enforce hazard exclusion from the manifest.
  - Added negative constraints to docs/CONTEXT and hardened context to fail on library hazards.
  - Updated TASK work log and recorded governance update in SoP.
- Verification:
  - `./ops/bin/dump --scope=platform`
  - `bash tools/lint/context.sh`
  - `bash tools/lint/truth.sh`
- Risk / rollback:
  - Risk: Low (governance and lint guard updates only).
  - Rollback: revert `TRUTH.md`, `AGENTS.md`, `docs/CONTEXT.md`, `tools/lint/context.sh`, and `SoP.md`.

## 2026-02-04 — DP-OPS-0018: Proposal Protocol and Drafting Friction Reduction

- Purpose: Reduce DP drafting deadlocks by allowing provisional branch and Base HEAD proposals while preserving worker git authority.
- What shipped:
  - Updated TASK template to allow Integrator-assigned or Integrator-proposed (Operator-created) work branch labeling and to allow Base HEAD to be `Not provided` or `Current (draft; lock at merge)` during drafting, with a drafting note on finalization and worker stop rules.
  - Added Drafting Proposal Protocol in AGENTS to permit Integrator proposals, require `PROPOSED:` prefixes during drafting, and reaffirm Operator-provided finalization and contractor branch limits.
  - Added zero-byte dump verification in TASK receipt and clarified Mandatory Closing Block checklist wording.
- Verification:
  - `bash tools/verify.sh`
  - `bash tools/lint/context.sh`
  - `bash tools/lint/truth.sh`
  - `bash tools/lint/dp.sh --test`
  - `./ops/bin/dump --scope=platform --format=chatgpt --out=auto --bundle`
- Risk / rollback:
  - Risk: Low (governance text updates only).
  - Rollback: revert `TASK.md`, `AGENTS.md`, and `SoP.md`.

## 2026-02-03 — DP-OPS-0016: Hardened TASK.md (context hygiene + mandatory closing block)

- Purpose: Harden TASK worker context boundaries, receipt discipline, and closeout metadata structure.
- What shipped:
  - Removed OPEN from worker context load instructions and added the Integrator-only OPEN rule plus disposable artifact prohibition.
  - Expanded receipt checklist to require OPEN, OPEN-PORCELAIN, and dump artifacts with explicit failure conditions.
  - Added the Mandatory Closing Block with six distinct commit and PR metadata fields.
- Verification:
  - `./ops/bin/dump --scope=platform`
  - `bash tools/lint/context.sh`
  - `bash tools/lint/truth.sh`
- Risk / rollback:
  - Risk: Low (governance text updates only).
  - Rollback: revert `TASK.md` and `SoP.md`.

## 2026-02-02 — DP-OPS-0015: Skills System Final Hardening and Consolidation

- Purpose: Consolidate S-LEARN-08 into S-LEARN-06 and harden S-LEARN-06 and S-LEARN-07 with Trap and Solution patterns plus concrete commands.
- What shipped:
  - Moved Advanced Git Forensics to S-LEARN-06 and removed S-LEARN-08.
  - Rewrote S-LEARN-06 and S-LEARN-07 with mandated Trap and Solution guidance and concrete command checks.
  - Updated docs/library/INDEX.md to register S-LEARN-06 and refresh the S-LEARN-07 title.
- Verification:
  - `./ops/bin/dump --scope=platform`
  - `bash tools/lint/context.sh`
  - `bash tools/lint/truth.sh`
  - `bash tools/lint/library.sh`
  - `bash tools/verify.sh` (PASS with 3 warnings: storage/archives, storage/documentation, storage/ToDo)
- Risk / rollback:
  - Risk: Low (documentation and registry updates).
  - Rollback: revert `docs/library/skills/S-LEARN-06.md`, `docs/library/skills/S-LEARN-07.md`, `docs/library/INDEX.md`, and `SoP.md`.

## 2026-02-02 — DP-OPS-0014: Skills System Hardening and Polishing

- Purpose: Harden S-LEARN-01 through S-LEARN-05 with Stela stack concrete specs and enforce receipt bundle mandate in TASK.
- What shipped:
  - Rewrote S-LEARN-01 through S-LEARN-05 with stack-specific commands, traps, and isolation rules.
  - Defined Zenith envelope and hook contract plus coding and security standards for the Next.js/FastAPI/Supabase stack.
  - Updated TASK proof bundle checklist with automatic disapproval mandate.
- Verification:
  - `./ops/bin/dump --scope=platform`
  - `bash tools/lint/context.sh`
  - `bash tools/lint/truth.sh`
  - `bash tools/lint/library.sh`
  - `bash tools/verify.sh` (PASS with 3 warnings: storage/archives, storage/documentation, storage/ToDo)
- Risk / rollback:
  - Risk: Low (documentation-only skill and TASK updates).
  - Rollback: revert `docs/library/skills/S-LEARN-01.md` through `docs/library/skills/S-LEARN-05.md`, `TASK.md`, and `SoP.md`.

## 2026-02-02 — DP-OPS-0013: Legacy Skill Refactor (Museum Provenance)

- Purpose: Refactor legacy skills S-LEARN-01 through S-LEARN-05 to align with the S-LEARN-07 template and add Museum Provenance.
- What shipped:
  - Updated S-LEARN-01 through S-LEARN-05 with Museum Provenance and Friction Context.
  - Standardized headers and procedure structure to match S-LEARN-07 and rewrote guidance with Trap/Solution specificity.
- Verification:
  - `./ops/bin/dump --scope=platform`
  - `bash tools/lint/context.sh`
  - `bash tools/lint/truth.sh`
- Risk / rollback:
  - Risk: Low (documentation-only skill refactor).
  - Rollback: revert `docs/library/skills/S-LEARN-01.md` through `docs/library/skills/S-LEARN-05.md` and `SoP.md`.

## 2026-02-01 — DP-OPS-0012: Autonomous Skill Heuristics and Provenance Engine (Phase 2)

- Purpose: Upgrade the Skills Subsystem with heuristics-driven provenance, semantic drift guard, and the harvest lifecycle refinements.
- What shipped:
  - Added `ops/lib/scripts/heuristics.sh` to analyze git diff and churn for provenance.
  - Updated `ops/lib/scripts/skill.sh` to source heuristics, enforce semantic collision checks, and auto-generate provenance.
  - Updated `SKILL.md`, `TASK.md`, and `AGENTS.md` to document Phase 2 workflow and constraints.
  - Updated `docs/library/skills/S-LEARN-07.md` with heuristics-aware guidance.
  - Added `docs/library/skills/S-LEARN-08.md` and registered it in `docs/library/INDEX.md`.
- Verification:
  - `./ops/bin/dump --scope=platform`
  - `bash tools/lint/context.sh`
  - `bash tools/lint/truth.sh`
  - `bash tools/lint/library.sh`
  - `bash tools/verify.sh`
  - `bash ops/lib/scripts/skill.sh check`
- Risk / rollback:
  - Risk: Medium (new heuristics engine and workflow changes).
  - Rollback: revert `ops/lib/scripts/heuristics.sh`, `ops/lib/scripts/skill.sh`, `SKILL.md`, `TASK.md`, `AGENTS.md`, `docs/library/skills/S-LEARN-07.md`, `docs/library/skills/S-LEARN-08.md`, `docs/library/INDEX.md`, and `SoP.md`.

## 2026-02-01 — DP-OPS-0011: Autonomous Skill Harvesting Engine

- Purpose: Upgrade the skill harvesting workflow with provenance capture, draft promotion, and Skills Context Hazard enforcement.
- What shipped:
  - Refactored `ops/lib/scripts/skill.sh` with harvest/promote/check subcommands, provenance capture, draft handling, collision-safe ID allocation (including `SKILL.md`), and context hazard enforcement.
  - Documented the harvest workflow and promotion log in `SKILL.md`.
  - Updated `TASK.md`, `AGENTS.md`, and `docs/library/MANUAL.md` to document the workflow and closeout responsibilities.
  - Added `docs/library/skills/S-LEARN-07.md` and registered it in `docs/library/INDEX.md`.
- Verification:
  - `./ops/bin/dump --scope=platform --format=chatgpt --out=auto --bundle`
  - `bash tools/lint/context.sh`
  - `bash tools/lint/truth.sh`
  - `bash tools/lint/library.sh`
  - `bash tools/verify.sh`
  - `bash tools/lint/dp.sh --test`
- Risk / rollback:
  - Risk: Medium (new skill workflow automation and canon updates).
  - Rollback: revert `ops/lib/scripts/skill.sh`, `SKILL.md`, `TASK.md`, `AGENTS.md`, `docs/library/MANUAL.md`, `docs/library/INDEX.md`, `docs/library/skills/S-LEARN-07.md`, and `SoP.md`.

## 2026-01-31 — DP-OPS-0010: Skills subsystem and skill capture

- Purpose: Establish a Skills subsystem for production payload work with explicit Context Hazard and a worker-run capture step.
- What shipped:
  - Added `SKILL.md` as the promotion template for creating new S-LEARN-XX skills, including Context Hazard rules, candidate log, and promotion packet template.
  - Added `docs/library/skills` with S-LEARN-01 through S-LEARN-05 for on-demand production payload guidance.
  - Added `ops/lib/scripts/skill.sh` to append candidate entries and matching Promotion Packets to `SKILL.md`.
  - Updated `TASK.md` to require worker-run skill capture during normal DP processing, including allowlist and RESULTS proof rules.
  - Updated `docs/library/INDEX.md` to register Skills artifacts for Library Guard.
  - Recorded the Context Hazard decision to keep Skills out of `ops/lib/manifests/CONTEXT.md`.
- Verification:
  - `./ops/bin/dump --scope=platform`
  - `bash tools/lint/context.sh`
  - `bash tools/lint/truth.sh`
  - `bash tools/lint/library.sh`
  - `bash tools/verify.sh`
  - `bash tools/lint/dp.sh --test`
- Risk / rollback:
  - Risk: Medium (new workflow and capture utility).
  - Rollback: revert `SKILL.md`, `docs/library/skills/`, `ops/lib/scripts/skill.sh`, `docs/library/INDEX.md`, `TASK.md`, and `SoP.md`.



## TRUTH.md
# TRUTH.md

## 1. Filing Doctrine
Filing:
- `ops/` = Run (binaries, manifests, automation).
- `docs/` = Explain (manuals and rationale).
- `projects/` = Work (payload code).
- `storage/` = Trash (local artifacts, never canon).

## 2. Axioms (Constitution)
- Precedence: TRUTH is final authority; if conflict exists, stop and ask.
- SSOT: one canonical file per domain; other mentions are pointers.
- Reuse-first: search ops/ for an existing template before creating a new artifact.
- Context Hazard: any inclusion of `docs/library/agents`, `docs/library/tasks`, or `docs/library/skills` in the global context manifest is a failure.
- Drift: any divergence between canon and repository state, or duplication of canon outside SSOT, is a failure state that requires stop and correction.
- SoP: history ledger only; no permanent rules live there.

## 3. Canon Surfaces
- `TRUTH.md` - constitution and invariants.
- `TASK.md` - active work surface and DP contract.
- `SoP.md` - history ledger and shipment record.
- `AGENTS.md` - staffing protocol and behavioral logic.
- `docs/library/MANUAL.md` - operator mechanics.
- `docs/library/MAP.md` - context wayfinding.
- `ops/lib/manifests/CONTEXT.md` - required context set.
- `llms.txt` - discovery entry point.


